{"title":"java多语言整体总结","uid":"2c2d68894e7c5f8bd5c444b2861a0caa","slug":"多语言/java多语言整体总结","date":"2022-01-02T10:32:47.000Z","updated":"2022-01-03T13:18:26.751Z","comments":true,"path":"api/articles/多语言/java多语言整体总结.json","keywords":null,"cover":"https://cdn.jsdelivr.net/gh/jp-polnareff/image-hosting@master/20220103/image.3ow6o0ifgte0.webp","content":"<h1 id=\"1-页面上几种不同类型多语言\"><a href=\"#1-页面上几种不同类型多语言\" class=\"headerlink\" title=\"1 页面上几种不同类型多语言\"></a>1 页面上几种不同类型多语言</h1><table class=\"half\">\n    <td><img src=\"https://cdn.jsdelivr.net/gh/jp-polnareff/image-hosting@master/20220103/QQ截图20220103144058.5aoc34ovez40.webp\" alt=\"QQ截图20220103144058\" width=\"300\" height=\"500\"  /></td>\n    <td><img src=\"https://cdn.jsdelivr.net/gh/jp-polnareff/image-hosting@master/20220103/QQ截图20220103145522.44dos5f1wka0.webp\" alt=\"QQ截图20220103145522\" width=\"300\" height=\"500\"  /></td>\n</table>\n\n<ul>\n<li>页面上多语言（<strong>红色框对应的部分header&amp;footer</strong>）：这部分可以直接甩锅给前端的大哥</li>\n<li>后端接口数据涉及多语言（<strong>绿色框对应的部分</strong>）：通过多语言基表</li>\n<li>后端接口参数校验抛出的内容：i18n + 自定义Validator</li>\n</ul>\n<h1 id=\"2-多语言基表设计\"><a href=\"#2-多语言基表设计\" class=\"headerlink\" title=\"2 多语言基表设计\"></a>2 多语言基表设计</h1><table>\n<thead>\n<tr>\n<th align=\"center\">字段</th>\n<th align=\"center\">类型</th>\n<th align=\"center\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">id</td>\n<td align=\"center\">bigint</td>\n<td align=\"center\">id 自增</td>\n</tr>\n<tr>\n<td align=\"center\">source_id</td>\n<td align=\"center\">varchar</td>\n<td align=\"center\">来源id</td>\n</tr>\n<tr>\n<td align=\"center\">source</td>\n<td align=\"center\">varchar</td>\n<td align=\"center\">来源：表名</td>\n</tr>\n<tr>\n<td align=\"center\">field</td>\n<td align=\"center\">varchar</td>\n<td align=\"center\">字段名</td>\n</tr>\n<tr>\n<td align=\"center\">lang</td>\n<td align=\"center\">varchar</td>\n<td align=\"center\">zh_CN、en_US</td>\n</tr>\n<tr>\n<td align=\"center\">value</td>\n<td align=\"center\">varchar</td>\n<td align=\"center\">多语言相关内容，也可考虑存json文本</td>\n</tr>\n</tbody></table>\n<pre class=\"line-numbers language-markdown\" data-language=\"markdown\"><code class=\"language-markdown\">:::tip\nsource_id、source、field &amp; lang 确定一个唯一数据\n:::</code></pre>\n\n<h1 id=\"3-i18n-自定义Validator\"><a href=\"#3-i18n-自定义Validator\" class=\"headerlink\" title=\"3 i18n + 自定义Validator\"></a>3 i18n + 自定义Validator</h1><h2 id=\"3-1-i18n配置\"><a href=\"#3-1-i18n配置\" class=\"headerlink\" title=\"3.1 i18n配置\"></a>3.1 i18n配置</h2><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">@Bean\npublic MessageSource messageSource() &#123;\n    ReloadableResourceBundleMessageSource messageSource &#x3D; new ReloadableResourceBundleMessageSource();\n    messageSource.setBasename(&quot;classpath:messages&#x2F;validation&quot;);\n    messageSource.setCacheMillis(-1L);\n    messageSource.setDefaultEncoding(&quot;utf-8&quot;);\n    return messageSource;\n&#125;</code></pre>\n\n<pre class=\"line-numbers language-markdown\" data-language=\"markdown\"><code class=\"language-markdown\">basename: 多语言资源文件地址\ncacheMillis: 缓存加载的属性文件的毫秒数，1表示永远缓存\ndefaultEncoding: 解析属性文件的默认字符集</code></pre>\n\n<h2 id=\"3-2-自定义区域解析器\"><a href=\"#3-2-自定义区域解析器\" class=\"headerlink\" title=\"3.2 自定义区域解析器\"></a>3.2 自定义区域解析器</h2><p>从请求header中LANG或请求参数的lang来解析用户区域</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">@Bean(name &#x3D; &quot;localeResolver&quot;)\npublic LocaleResolver getLocaleResolver() &#123;\n    return new I18nLocaleResolver();\n&#125;\n\n&#x2F;**\n * 获取请求头国际化信息\n *&#x2F;\nstatic class I18nLocaleResolver implements LocaleResolver &#123;\n\n    @NotNull\n    @Override\n    public Locale resolveLocale(HttpServletRequest request) &#123;\n        String language &#x3D; Optional.ofNullable(request.getHeader(&quot;LANG&quot;))\n                .orElse(request.getParameter(&quot;lang&quot;));\n        Locale locale &#x3D; Locale.getDefault();\n        if (Strings.isNotBlank(language)) &#123;\n\n            String[] split &#x3D; language.split(&quot;_&quot;);\n            locale &#x3D; new Locale(split[0], split[1]);\n        &#125;\n        return locale;\n    &#125;\n\n    @Override\n    public void setLocale(@NotNull HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Locale locale) &#123;\n\n    &#125;\n&#125;</code></pre>\n\n<pre class=\"line-numbers language-markdown\" data-language=\"markdown\"><code class=\"language-markdown\">LocaleResolver bean的name要设置为localeResolver，原因参考下面源码。</code></pre>\n\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">private void initLocaleResolver(ApplicationContext context) &#123;\n   try &#123;\n      this.localeResolver &#x3D; context.getBean(LOCALE_RESOLVER_BEAN_NAME, LocaleResolver.class);\n      if (logger.isTraceEnabled()) &#123;\n         logger.trace(&quot;Detected &quot; + this.localeResolver);\n      &#125;\n      else if (logger.isDebugEnabled()) &#123;\n         logger.debug(&quot;Detected &quot; + this.localeResolver.getClass().getSimpleName());\n      &#125;\n   &#125;\n   catch (NoSuchBeanDefinitionException ex) &#123;\n      &#x2F;&#x2F; We need to use the default.\n      this.localeResolver &#x3D; getDefaultStrategy(context, LocaleResolver.class);\n      if (logger.isTraceEnabled()) &#123;\n         logger.trace(&quot;No LocaleResolver &#39;&quot; + LOCALE_RESOLVER_BEAN_NAME +\n               &quot;&#39;: using default [&quot; + this.localeResolver.getClass().getSimpleName() + &quot;]&quot;);\n      &#125;\n   &#125;\n&#125;</code></pre>\n\n<h2 id=\"3-3-统一参数异常处理\"><a href=\"#3-3-统一参数异常处理\" class=\"headerlink\" title=\"3.3 统一参数异常处理\"></a>3.3 统一参数异常处理</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">@ExceptionHandler(value &#x3D; BindException.class)\n@ResponseBody\npublic GenericResult bindExceptionHandler(BindException e) &#123;\n    String message &#x3D; e.getAllErrors().stream()\n            .map(DefaultMessageSourceResolvable::getDefaultMessage).collect(Collectors.joining(&quot;,&quot;));\n    return GenericResult.fail(&quot;400&quot;, message);\n&#125;</code></pre>\n\n<pre class=\"line-numbers language-markdown\" data-language=\"markdown\"><code class=\"language-markdown\">这里一般转换为自己项目的自定义异常</code></pre>\n","feature":null,"text":"1 页面上几种不同类型多语言 页面上多语言（红色框对应的部分header&amp;footer）：这部分可以直接甩锅给前端的大哥 后端接口数据涉及多语言（绿色框对应的部分）：通过多语言基表 后端接口参数校验抛出的内容：i18n + 自定义Validator 2 多语言基表设计 字...","link":"","photos":[],"count_time":{"symbolsCount":"3.2k","symbolsTime":"3 mins."},"categories":[{"name":"学习总结","slug":"学习总结","count":1,"path":"api/categories/学习总结.json"}],"tags":[{"name":"i18n","slug":"i18n","count":1,"path":"api/tags/i18n.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#1-%E9%A1%B5%E9%9D%A2%E4%B8%8A%E5%87%A0%E7%A7%8D%E4%B8%8D%E5%90%8C%E7%B1%BB%E5%9E%8B%E5%A4%9A%E8%AF%AD%E8%A8%80\"><span class=\"toc-text\">1 页面上几种不同类型多语言</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#2-%E5%A4%9A%E8%AF%AD%E8%A8%80%E5%9F%BA%E8%A1%A8%E8%AE%BE%E8%AE%A1\"><span class=\"toc-text\">2 多语言基表设计</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#3-i18n-%E8%87%AA%E5%AE%9A%E4%B9%89Validator\"><span class=\"toc-text\">3 i18n + 自定义Validator</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3-1-i18n%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">3.1 i18n配置</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3-2-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8C%BA%E5%9F%9F%E8%A7%A3%E6%9E%90%E5%99%A8\"><span class=\"toc-text\">3.2 自定义区域解析器</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3-3-%E7%BB%9F%E4%B8%80%E5%8F%82%E6%95%B0%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86\"><span class=\"toc-text\">3.3 统一参数异常处理</span></a></li></ol></li></ol>","author":{"name":"Polnareff","slug":"blog-author","avatar":"https://cdn.jsdelivr.net/gh/jp-polnareff/image-hosting@master/20210423/image123.47oj8cvm3fu0.jpg","link":"/","description":"Travel around in search of her sister's killer","socials":{"github":"https://github.com/jp-polnareff","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/5254061686","zhihu":"","csdn":"","juejin":""}},"mapped":true,"prev_post":{"title":"2022年1月9号","uid":"3a8a309ff5cb46fb158f7e047d031528","slug":"illusion/20220109","date":"2022-01-09T14:32:47.000Z","updated":"2022-01-09T15:12:56.444Z","comments":true,"path":"api/articles/illusion/20220109.json","keywords":null,"cover":"https://cdn.jsdelivr.net/gh/jp-polnareff/image-hosting@master/20220109/image.37h2g2oalmo0.webp","text":" 日期：2022年1月9号 星期天 地点：成都 天气：雾夹雨一整天 ​ 带上一首你比较喜欢的公路，成都耸立的写字楼看不出成都的繁华，而感觉像是一栋栋的坟墓；路上的大爷问我：师傅，曹家巷怎么走？ 我竟一时间忘了自己也是个异乡客。回到自己住了快三年的出租屋，点上一支烟，思考了很多很多...","link":"","photos":[],"count_time":{"symbolsCount":224,"symbolsTime":"1 mins."},"categories":[{"name":"感悟","slug":"感悟","count":1,"path":"api/categories/感悟.json"}],"tags":[{"name":"sentiment","slug":"sentiment","count":1,"path":"api/tags/sentiment.json"}],"author":{"name":"Polnareff","slug":"blog-author","avatar":"https://cdn.jsdelivr.net/gh/jp-polnareff/image-hosting@master/20210423/image123.47oj8cvm3fu0.jpg","link":"/","description":"Travel around in search of her sister's killer","socials":{"github":"https://github.com/jp-polnareff","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/5254061686","zhihu":"","csdn":"","juejin":""}}},"next_post":{"title":"代码量统计工具-GitStats","uid":"7a07eb5d59a9e9ff4655ee40e094d0bf","slug":"工具/代码量统计","date":"2021-06-02T10:32:47.000Z","updated":"2022-01-02T16:47:54.097Z","comments":true,"path":"api/articles/工具/代码量统计.json","keywords":null,"cover":"https://cdn.jsdelivr.net/gh/jp-polnareff/image-hosting@master/20210423/image.4t81bmup1sa0.png","text":"GitStatsGit历史统计生成数据表： 一般统计：总文件，行，提交，作者。 活动：按小时，周，年，等。 作者：作者列表（名称，提交（％），首次提交日期，最后提交日期，年龄，年份，年度作者。 文件：文件计数到日期，扩展 行：代码线按日期 1.克隆项目 git clone git...","link":"","photos":[],"count_time":{"symbolsCount":570,"symbolsTime":"1 mins."},"categories":[{"name":"工具","slug":"工具","count":1,"path":"api/categories/工具.json"}],"tags":[{"name":"tools","slug":"tools","count":2,"path":"api/tags/tools.json"}],"author":{"name":"Polnareff","slug":"blog-author","avatar":"https://cdn.jsdelivr.net/gh/jp-polnareff/image-hosting@master/20210423/image123.47oj8cvm3fu0.jpg","link":"/","description":"Travel around in search of her sister's killer","socials":{"github":"https://github.com/jp-polnareff","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/5254061686","zhihu":"","csdn":"","juejin":""}}}}