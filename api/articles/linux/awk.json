{"title":"AWK 样式扫描和处理语言","uid":"0ae44ea2c5de8fc0dba98b172b9416ad","slug":"linux/awk","date":"2021-04-15T10:32:47.000Z","updated":"2022-01-02T16:47:54.074Z","comments":true,"path":"api/articles/linux/awk.json","keywords":null,"cover":"https://cdn.jsdelivr.net/gh/jp-polnareff/image-hosting@master/20210423/image.6rex2bvab6k0.png","content":"<h1 id=\"AWK-样式扫描和处理语言\"><a href=\"#AWK-样式扫描和处理语言\" class=\"headerlink\" title=\"AWK 样式扫描和处理语言\"></a>AWK 样式扫描和处理语言</h1><h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>AWK（其名称得自于它的创始人阿尔佛雷德·艾侯、彼得·温伯格和布莱恩·柯林汉姓氏的首个字母）是一种优良的文本处理工具，Linux及Unix环境中现有的功能最强大的数据处理引擎之一。AWK提供了极其强大的功能：可以进行正则表达式的匹配，样式装入、流控制、数学运算符、进程控制语句甚至于内置的变量和函数。</p>\n<p>该工具扫描文件中的每一行，查找与命令行中所给定内容相匹配的模式。如果发现匹配内容，则进行下一个编程步骤。如果找不到匹配内容，则继续处理下一行。</p>\n<h2 id=\"命令\"><a href=\"#命令\" class=\"headerlink\" title=\"命令\"></a>命令</h2><pre class=\"line-numbers language-sh\" data-language=\"sh\"><code class=\"language-sh\">awk [ -F fs ] [ -v var&#x3D;value ] [ &#39;prog&#39; | -f progfile ] [ file ...  ]</code></pre>\n\n<ul>\n<li><code>-F s</code> ：指定输入文件折分隔符，fs是一个字符串或者是一个正则表达式</li>\n<li><code>-v var=value</code>：赋值一个用户定义变量</li>\n<li><code>-f progfile</code>：从脚本文件中读取awk命令</li>\n</ul>\n<h3 id=\"内建变量\"><a href=\"#内建变量\" class=\"headerlink\" title=\"内建变量\"></a>内建变量</h3><p>AWK的内建变量包括域变量，例如$1, $2, $3，以及</p>\n<ul>\n<li><code>$0</code>：整行记录</li>\n<li><code>$1, $2, $3...</code>：分别被分隔符分割的1,2,3…词</li>\n<li><code>NR</code>：已经读出的记录数，就是行号，从1开始</li>\n<li><code>NF</code>：一条记录的字段的数目</li>\n<li><code>FILENAME</code>：当前输入文件的文件名。</li>\n<li><code>FS</code>：“字段分隔符”，字段分隔符(默认是任何空格)。</li>\n<li><code>RS</code>：记录分隔符(默认是一个换行符)</li>\n<li><code>OFS</code>：“输出字段分隔符，默认值与输入字段分隔符一致。</li>\n<li><code>ORS</code>：输出记录分隔符(默认值是一个换行符)</li>\n<li><code>OFMT</code>：数字的输出格式(默认值是%.6g)</li>\n</ul>\n<h3 id=\"内置函数\"><a href=\"#内置函数\" class=\"headerlink\" title=\"内置函数\"></a><a href=\"https://www.runoob.com/w3cnote/awk-built-in-functions.html\">内置函数</a></h3><h3 id=\"awk脚本\"><a href=\"#awk脚本\" class=\"headerlink\" title=\"awk脚本\"></a>awk脚本</h3><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">#运行前\nBEGIN &#123;\n\n&#125;\n#运行中\n&#123;\n\n&#125;\n#运行后\nEND &#123;\n\n&#125;</code></pre>\n\n\n\n<h2 id=\"常见案例\"><a href=\"#常见案例\" class=\"headerlink\" title=\"常见案例\"></a>常见案例</h2><pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\"># 邮件列表\n$ cat mail-list\n阿米莉亚555-5553 amelia.zodiacusque@gmail.com F\n安东尼555-3412 anthony.asserturo@hotmail.com A\n贝基555-7685 becky.algebrarum@gmail.com A\n第555-1675号法案bill.drowning@hotmail.com A\n布罗德里克555-0542 broderick.aliquotiens@yahoo.com R\n卡米拉555-2912 camilla.infusarum@skynet.be R\nFabius 555-1234 fabius.undevicesimus@ucb.edu F\n朱莉555-6699 julie.perscrutabor@skeeve.com F\n马丁555-6480 martin.codicibus@hotmail.com A\n塞缪尔555-3430 samuel.lanceolis@shu.edu A\n让·保罗555-2127 jeanpaul.campanorum@nyu.edu R\n# 库存发货：绿红橙蓝包装每个月出货的数量\n$ cat inventory-shipped\nJan  13  25  15 115\nFeb  15  32  24 226\nMar  15  24  34 228\nApr  31  52  63 420\nMay  16  34  29 208\nJun  31  42  75 492\nJul  24  34  67 436\nAug  15  34  47 316\nSep  13  55  37 277\nOct  29  54  68 525\nNov  20  87  82 577\nDec  17  35  61 401\n\nJan  21  36  64 620\nFeb  26  58  80 652\nMar  24  75  70 495\nApr  21  70  74 514</code></pre>\n\n<p><strong>带gmail的数据行</strong></p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">awk &#39;&#x2F;gmail&#x2F; &#123; print $0 &#125;&#39; mail-list</code></pre>\n\n<p><strong>长度大于50</strong></p>\n<pre class=\"line-numbers language-sh\" data-language=\"sh\"><code class=\"language-sh\">awk &#39;length($0) &gt; 50&#39; mail-list</code></pre>\n\n<p><strong>打印最长数据行长度</strong></p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">awk &#39;&#123; if (length($0) &gt; max) max &#x3D; length($0) &#125;\n     END &#123; print max &#125;&#39; mail-list\n# 或     \nexpand mail-list | awk &#39;&#123; if (x &lt; length($0)) x &#x3D; length($0) &#125;\n                   END &#123; print &quot;maximum line length is &quot; x &#125;&#39;     </code></pre>\n\n<p><strong>打印至少有一个字读的数据行</strong></p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">awk &#39;NF &gt; 0&#39; inventory-shipped</code></pre>\n\n<p><strong>打印文件列表字节总数</strong></p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">ls -l | awk &#39;&#123; x +&#x3D; $5 &#125;\n                   END &#123; print &quot;total bytes: &quot; x &#125;&#39;</code></pre>\n\n<p><strong>打印所有用户的登录名的排序列表</strong></p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">awk -F: &#39;&#123; print $1 &#125;&#39; &#x2F;etc&#x2F;passwd | sort</code></pre>\n\n<p><strong>打印邮件列表行数</strong></p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">awk &#39;END &#123; print NR &#125;&#39; mail-list</code></pre>\n\n<p><strong>mail-list中查带12的，inventory-shipped中查带27的</strong></p>\n<pre class=\"line-numbers language-sh\" data-language=\"sh\"><code class=\"language-sh\">awk &#39;&#x2F;12&#x2F; &#123; print $0 &#125; ;\n      &#x2F;27&#x2F; &#123; print $0 &#125;&#39; mail-list inventory-shipped</code></pre>\n\n<p><strong>统计project目录下java文件行数</strong></p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">find .&#x2F;project -name &quot;*.java&quot;\\\n| xargs awk &#39;END&#123;print NR&#125;&#39;\\\n| awk &#39;&#123;sum +&#x3D; $0&#125; END &#123; print &quot;sum &quot; sum &#125;&#39;</code></pre>\n\n<p><strong>统计一个大文本中单词出现次数最高的3个单词</strong></p>\n<pre class=\"line-numbers language-shell\" data-language=\"shell\"><code class=\"language-shell\">awk &#39;&#123;for(i&#x3D;1;i&lt;&#x3D;NF;i++)sum[$i]++&#125; END &#123;for(k in sum) print k &quot;:&quot; sum[k]&#125;&#39; inventory-shipped \\\n| sort -n -k 2 -t : -r \\\n| head -3</code></pre>\n\n","feature":null,"text":"AWK 样式扫描和处理语言简介AWK（其名称得自于它的创始人阿尔佛雷德·艾侯、彼得·温伯格和布莱恩·柯林汉姓氏的首个字母）是一种优良的文本处理工具，Linux及Unix环境中现有的功能最强大的数据处理引擎之一。AWK提供了极其强大的功能：可以进行正则表达式的匹配，样式装入、流控制...","link":"","photos":[],"count_time":{"symbolsCount":"3k","symbolsTime":"3 mins."},"categories":[{"name":"学习记录","slug":"学习记录","count":14,"path":"api/categories/学习记录.json"}],"tags":[{"name":"Linux","slug":"Linux","count":2,"path":"api/tags/Linux.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#AWK-%E6%A0%B7%E5%BC%8F%E6%89%AB%E6%8F%8F%E5%92%8C%E5%A4%84%E7%90%86%E8%AF%AD%E8%A8%80\"><span class=\"toc-text\">AWK 样式扫描和处理语言</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%AE%80%E4%BB%8B\"><span class=\"toc-text\">简介</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%91%BD%E4%BB%A4\"><span class=\"toc-text\">命令</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%86%85%E5%BB%BA%E5%8F%98%E9%87%8F\"><span class=\"toc-text\">内建变量</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">内置函数</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#awk%E8%84%9A%E6%9C%AC\"><span class=\"toc-text\">awk脚本</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B\"><span class=\"toc-text\">常见案例</span></a></li></ol></li></ol>","author":{"name":"Polnareff","slug":"blog-author","avatar":"https://cdn.jsdelivr.net/gh/jp-polnareff/image-hosting@master/20210423/image123.47oj8cvm3fu0.jpg","link":"/","description":"Travel around in search of her sister's killer","socials":{"github":"https://github.com/jp-polnareff","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/5254061686","zhihu":"","csdn":"","juejin":""}},"mapped":true,"prev_post":{"title":"GraphQL初探","uid":"265980696829f8e89187dcd1752370ec","slug":"network/graphql初探","date":"2021-05-16T10:32:47.000Z","updated":"2022-01-02T16:47:54.085Z","comments":true,"path":"api/articles/network/graphql初探.json","keywords":null,"cover":null,"text":"简介A query language for your API API的查询语言，是用于使用现有数据来完成这些查询的运行时。GraphQL为您的API中的数据提供了完整且易于理解的描述，使客户能够准确地询问他们需要什么。 ","link":"","photos":[],"count_time":{"symbolsCount":111,"symbolsTime":"1 mins."},"categories":[{"name":"学习记录","slug":"学习记录","count":14,"path":"api/categories/学习记录.json"}],"tags":[{"name":"GraphQL","slug":"GraphQL","count":1,"path":"api/tags/GraphQL.json"}],"author":{"name":"Polnareff","slug":"blog-author","avatar":"https://cdn.jsdelivr.net/gh/jp-polnareff/image-hosting@master/20210423/image123.47oj8cvm3fu0.jpg","link":"/","description":"Travel around in search of her sister's killer","socials":{"github":"https://github.com/jp-polnareff","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/5254061686","zhihu":"","csdn":"","juejin":""}}},"next_post":{"title":"Pulsar之message篇","uid":"55ea1ac8b6eebb4c3c1010cae15373f5","slug":"mq/pulsar_message","date":"2021-04-06T10:32:47.000Z","updated":"2022-01-02T16:47:54.080Z","comments":true,"path":"api/articles/mq/pulsar_message.json","keywords":null,"cover":"https://cdn.jsdelivr.net/gh/jp-polnareff/image-hosting@master/20210423/image.4caxs5p9qou0.png","text":"Pulsar之message篇Pulsar建立在pub-sub上，该设计模式中，producer 发布消息到 topic， Consumer 订阅 topic、处理发布的消息，并在处理完成后发送确认。 一旦创建订阅，即使 consumer 断开连接，Pulsar 仍然可以保存所有...","link":"","photos":[],"count_time":{"symbolsCount":"6.3k","symbolsTime":"6 mins."},"categories":[{"name":"学习记录","slug":"学习记录","count":14,"path":"api/categories/学习记录.json"}],"tags":[{"name":"Pulsar","slug":"Pulsar","count":2,"path":"api/tags/Pulsar.json"}],"author":{"name":"Polnareff","slug":"blog-author","avatar":"https://cdn.jsdelivr.net/gh/jp-polnareff/image-hosting@master/20210423/image123.47oj8cvm3fu0.jpg","link":"/","description":"Travel around in search of her sister's killer","socials":{"github":"https://github.com/jp-polnareff","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/5254061686","zhihu":"","csdn":"","juejin":""}}}}